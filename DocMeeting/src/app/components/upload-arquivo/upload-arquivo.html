<div class="upload-section">
  <label 
    for="fileInput" 
    class="custom-file-upload" 
    [class.disabled]="isLoading || !isLoggedIn"
  >
    @if (isLoading) {
      <span>â³ Processando Ã¡udio e gerando ata... aguarde</span>
    } @else if (!isLoggedIn) {
      <span>ğŸ”’ FaÃ§a login para enviar arquivos</span>
    } @else {
      <span>ğŸ“‚ Selecionar Arquivo (MP3, MP4, TXT)</span>
    }
  </label>
  
  <input 
    id="fileInput" 
    type="file" 
    accept=".mp3, .mp4, .txt" 
    (change)="onFileSelected($event)" 
    [disabled]="isLoading || !isLoggedIn"
  />
</div>

@if (meetings.length > 0) {
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Categoria</th>
          <th>Resumo RÃ¡pido</th>
          <th>Data/Hora</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        @for (m of meetings; track m.id) {
          <tr>
            <td><span class="badge">{{ m.category }}</span></td>
            <td>{{ m.summary }}</td>
            <td>{{ m.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
            <td class="actions">
              <button (click)="viewMeeting(m)" class="btn-view" title="Visualizar">ğŸ‘ï¸</button>
              <button (click)="deleteMeeting(m.id)" class="btn-delete" title="Excluir">ğŸ—‘ï¸</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
}

@if (selectedMeeting) {
  <div class="modal-backdrop" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      
      <div class="modal-header">
        <div class="header-title">
          <h2>{{ selectedMeeting.category }}</h2>
          
          <button (click)="toggleEdit()" class="btn-icon-edit" title="Editar Ata">
            {{ isEditing ? 'âŒ Cancelar' : 'âœï¸ Editar' }}
          </button>

          @if (isEditing) {
            <button (click)="toggleSourceCode()" class="btn-icon-edit" title="Ver CÃ³digo Fonte">
              {{ showHtmlCode ? 'ğŸ‘ï¸ Ver Visual' : 'ğŸ’» Ver CÃ³digo' }}
            </button>
          }
        </div>
        <button (click)="closeModal()" class="close-btn">&times;</button>
      </div>
      
      <div class="modal-body">
        
        @if (isEditing) {
          @if (showHtmlCode) {
            <div class="edit-container">
              <p class="edit-hint code-hint">âš ï¸ Modo CÃ³digo: Cuidado com as tags HTML.</p>
              <textarea [(ngModel)]="selectedMeeting.full_content" class="editor-textarea" placeholder="Edite o conteÃºdo da ata aqui"></textarea>
            </div>
          } @else {
            <div class="edit-container">
              <p class="edit-hint visual-hint">âœ¨ Modo Visual: Clique e digite diretamente no texto abaixo.</p>
              
              <div 
                #visualEditor
                class="visual-editor" 
                contenteditable="true" 
                (input)="onVisualContentChange($event)"
              ></div>
            </div>
          }

        } @else {
          <div [innerHTML]="selectedMeeting.full_content"></div>
        }
      </div>
  
      <div class="modal-footer">
        @if (isEditing) {
          <button (click)="saveEdit()" class="btn-primary">ğŸ’¾ Salvar AlteraÃ§Ãµes</button>
        } @else {
          <button (click)="copyContent()" class="btn-secondary">ğŸ“‹ Copiar Texto</button>
          <button (click)="sendEmail()" class="btn-primary">âœ‰ï¸ Enviar por E-mail</button>
        }
      </div>

    </div>
  </div>
}

@if (isLoading) {
  <app-loading [message]="loadingMessage"></app-loading>
}